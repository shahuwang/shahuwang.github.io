今天想写的是关于词法分析方面的内容，这应该算是编译器开始工作的第一步了，就是把用户输入的编程语言的代码文件，解析成为编译器后面步骤可以理解的东西。

当然，由于涉及的知识相当多，所以前面很长的一部分内容都是用于解释一些基本概念。

首先，我们先来定义一下什么叫做编译器，以及什么是解释器，两者的区别又是什么。

*   编译器就是将一种语言编写的代码转换为另一种语言。譬如 C 语言的编译器把 C 语言的代码转换为汇编代码。
*   解释器其实也可以说是将一种语言编写的代码转换为另一种语言，譬如 Python 的解释器就是把 Python 代码转换为 C 语言。与编译器不一样的是，这个翻译过程是实时执行代码的，来一句 x+y 就马上转换为 C 语言的 x + y 。

<!--more-->

可以说，编译器很像传统的书籍翻译作者，把英文的书翻译成中文的书。 而解释器呢，则更像同声传译，说一句翻译一句。

一般来说，编译器主要包含两个部分，前端和后端，还包括一个中间表示部分，通过中间表示，把前端和后端连接起来。我觉得下面这张图对编译器工作过程说明得挺好的。(注：[图片来源](http://a1.att.hudong.com/66/70/01300000244176122562704082014.gif))

![compiler](https://raw.githubusercontent.com/shahuwang/images/master/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/compiler.gif)

其中，各个部分归属如下：

*   词法分析、语法分析和语义分析属于编译前端，这三次分析的过程中，会生成符号存于符号表中，同时在语法和语义分析阶段还会进行诊查处理。
*   中间代码生成和优化属于中间表示部分，至于什么是中间代码呢，其实就是编译器用一些数据结构表示它处理的代码，譬如四则运算的代码，我们可以用一颗树来表示，然后规定一个遍历顺序，然后直接读取就能进行目标代码的转换了。优化就像字面意思那样啦，就是让生成的代码更加优秀。貌似现在编译器开发的主要工作都集中在这里了。
*   目标代码生成则属于编译后端了。一般我们所见的编译后端，都是把高级语言转换为低级语言。不过其实是有把低级语言转换为高级语言的编译器的，譬如反编译。

符号表是在词法分析，语法分析等过程中，收集、记录和使用源程序中一些语法符号的类型和特征等相关信息。这些信息一般以表格形式存储于系统中，如常数表、变量名表、数组名表、过程名表、标号表等，统称为符号表。对于符号表的组织、构造和管理方法的好坏会直接影响编译系统的运行效率。

大概的定义已经讲解完毕，现在开始将什么是词法分析。龙书是这样定义词法分析的：

> 编译器的第一个步骤称为词法分析（lexical analysis）或扫描（scanning）。词法分析器读入组成源程序的字符流，并且将它们组成有意义的词素（lexeme）的序列。对于每个词素，词法分析器产生如下形式的词法单元（token）作为输出：
> 
> *   < token-name, attribute-value)
> 
> 在这个词法单元中，第一个分量token-name是一个由语法分析步骤使用的抽象符号，attribute-value则指向符号表中关于这个词法单元的条目。 

上面又是词素，又是词法单元之类的，是不是看得很晕呢？其实对于词素，我现在理解的程度，即它就是一个独立的语法单元，譬如var a = b + 1, 这里 var，a，=， b， +， 1 都是词素。一大串的字符串，其实也只是一个词素。关于词法单元中的抽象符号，这是个事先约定的东西，譬如 a 是一个变量，那么我就用 id 来表示所有的变量。如果 a 是一个函数， 我可以用 func 这个抽象符号来表示。而attribute-value，一般是一个指针，指向符号表代表该词素的数据结构实例那里。

如 var a = b + 1 可能会被分析为： < var> < id, 1> <=> < id,2> <+> < num，1> ，这里var，+，=号都没有带attribute-value，其实也可以带的，看各自实现的需要吧。

其实词法分析器还会做其他的事情，比如把代码里面的空白和注释过滤掉，还有就是记录行数，以便后面的分析发现有错误的时候，可以指出在代码里的哪一行。像 C 语言还有宏的预处理器，其实就是在词法分析这个阶段，把宏代码插入到使用之处。

上面我已经已经把什么是词法分析器将清楚了，现在来关注用什么来实现词法分析器。

据我现在所具备的知识上来看，大部分的词法分析器主要是采用正则语言来实现，这里面涉及很多形式语言、自动机理论的知识，不过我觉得阅读一下我的这两篇文章入门一下就行了，分别是[《为什么括号不是可正则的语言》](http://www.shahuwang.com/2013/11/28/%e4%b8%ba%e4%bb%80%e4%b9%88%e6%8b%ac%e5%8f%b7%e4%b8%8d%e6%98%af%e5%8f%af%e6%ad%a3%e5%88%99%e7%9a%84%e8%af%ad%e8%a8%80.html)和[《什么是文法》](http://www.shahuwang.com/2013/12/31/%e4%bb%80%e4%b9%88%e6%98%af%e6%96%87%e6%b3%95.html)，就大致明白很多内容了。先根据语言语法的要求，设计一些正则表达式，然后用词法分析器生成器读取这些正则表达式，构造出一个可执行的词法分析器。所谓的词法分析器生成器，就是根据正则表达式，构建自动机，然后把所有语法对应的表达式所构建出来的自动机组合起来，形成一个优化的自动机，生成对应代码，即词法分析器。一些工具，如Lex和Flex，可以说就是这样的东西。

暂时我还不打算一下子就深入去了解学习NFA，DFA等等自动机与词法分析器的构造。我打算先按照本文这样，对编译原理的主要内容进行了解，到以后看机会再深入学习。
